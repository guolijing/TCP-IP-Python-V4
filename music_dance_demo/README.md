# Dobot Nova 2 音乐舞蹈Demo

让你的Dobot Nova 2机械臂随着音乐节奏跳舞！

## 更新说明（2025-08-04）

### 新功能
- **自动回到初始位置**：启用机器人后会自动移动到预设的初始位置
- **可配置初始位置**：可以在 `dance_config.json` 中自定义初始位置的关节角度
- **动作安全性改进**：所有预设动作现在都会在开始和结束时回到基准位置（-350, 0, 200, 180, 0, 0）
- **清除报警功能**：新增清除报警按钮，可以在机器人出错时快速恢复
- **实时报警监控**：界面上实时显示详细的报警信息，包括报警描述、原因和解决方案
- **可调速度控制**：
  - 界面滑块实时调整速度（10-100%）
  - 速度设置立即应用到所有移动命令
  - 默认速度可在配置文件中设置
- **奇异点检测和避免**：
  - 自动检测肩、腕、肘三种奇异点
  - 工作空间边界检查
  - 所有动作预验证确保安全性

### 配置初始位置
在 `dance_config.json` 文件中修改 `home_position` 配置：
```json
"home_position": {
    "joints": [0, 45, 45, 0, 90, 0],  // J1-J6的角度值
    "description": "机器人初始位置（关节角度）"
}
```

## 功能特性

- 🎵 **音乐节奏分析**：实时分析音频的节奏、能量和频率特征
- 🤖 **智能动作映射**：根据音乐特征自动选择合适的舞蹈动作
- 🎨 **图形化界面**：直观的控制面板，轻松管理音乐和机器人
- 📊 **实时信息显示**：查看机器人位置、状态和错误日志
- 🎯 **测试动作**：预设的测试动作帮助验证机器人功能

## 预设舞蹈动作

### 基础舞蹈动作（6种）
- **wave_right**: 左右摆动 - 适合中等节奏
- **wave_up**: 上下摆动 - 适合轻柔音乐
- **spin**: 旋转 - 适合高能量片段
- **figure_eight**: 8字形运动 - 适合流畅旋律
- **pump**: 快速上下运动 - 适合强节奏
- **sway**: 缓慢摇摆 - 适合慢节奏

### 测试动作（4种）
- 挥手 - 模拟人类挥手动作
- 画圆 - 在空中画圆形轨迹
- 点头 - 前后点头动作
- 摇头 - 左右摇头动作

## 安装要求

### 系统要求
- Python 3.7+
- Dobot Nova 2 机械臂
- TCP/IP网络连接

### 安装依赖
```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 启动程序
```bash
python main.py
```

### 2. 可选参数
```bash
# 指定机器人IP地址（会覆盖保存的配置）
python main.py --ip 192.168.100.1

# 无界面测试模式
python main.py --no-gui
```

### 3. 操作步骤
1. 点击"连接机器人"，在弹出的对话框中输入IP地址（支持快速选择常用IP）
2. 点击"启用机器人"
3. 程序会自动加载music文件夹中的音乐文件
4. 也可以选择其他音乐文件夹或添加单个音乐文件
5. 从列表中选择音乐
6. 点击"播放"开始播放音乐
7. 点击"开始跳舞"让机器人随音乐起舞

### 4. 配置说明
程序会自动保存以下配置到`dance_config.json`：
- 机器人IP地址：下次启动时自动使用上次的IP
- 音乐文件夹路径：记住上次选择的音乐文件夹
- 默认音乐文件夹为程序目录下的`music`文件夹

## 技术架构

### 核心模块
- **audio_analyzer.py**: 音频分析模块，提取节奏、能量等特征
- **dance_moves.py**: 舞蹈动作库，定义各种动作的关键帧
- **robot_controller.py**: 机器人控制模块，处理TCP/IP通信
- **dance_gui.py**: 图形界面模块，提供用户交互界面

### 音乐分析原理
- 使用librosa库进行音频特征提取
- 实时计算节拍强度和频率分布
- 根据音乐特征动态选择舞蹈动作

## 注意事项

1. **安全第一**: 确保机器人周围有足够的活动空间
2. **速度控制**: 建议初次使用时将速度设置在30-50%
3. **紧急停止**: 随时准备使用紧急停止按钮
4. **网络连接**: 确保机器人和电脑在同一网络中

## 故障排除

### 连接失败
- 检查IP地址是否正确
- 确认机器人已开机并连接网络
- 检查防火墙设置

### 音乐无法播放
- 确认音频文件格式支持（mp3, wav, ogg）
- 检查pygame音频系统初始化

### 动作不流畅
- 降低机器人运动速度
- 检查网络延迟
- 减少同时运行的其他程序

## 扩展开发

可以通过修改`dance_moves.py`添加新的舞蹈动作：

```python
# 创建新动作
new_move = DanceMove("my_move", "我的动作")
new_move.add_keyframe([x1, y1, z1, rx1, ry1, rz1], 0.0)
new_move.add_keyframe([x2, y2, z2, rx2, ry2, rz2], 0.5)
new_move.add_keyframe([x1, y1, z1, rx1, ry1, rz1], 1.0)
```

## 许可证

本项目基于Dobot官方Python API开发。